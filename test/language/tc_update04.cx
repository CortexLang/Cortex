bool result : true
void fail(string msg):
    "tc_update04: FAIL: $msg"
    result = false

bool aUpdated, bUpdated, cUpdated, dUpdated, eUpdated
    
// Test updating a primtive
int32 a_o: 10
var int32& a = a_o
a := 20
on update a_o:
    aUpdated = true 
    if a_o != 20: 
        fail("a_o != 20")

// Test updating a composite object
struct Point::
    x, y: int32

Point b_o: 10, 20
var Point& b = b_o
b := {30, 40}
on update b_o: 
    bUpdated = true
    if b_o[x, y] != (30, 40): 
        fail("b_o[x, y] != (30, 40)")

Point c_o: 10, 20
var Point& c = c_o
c.x := 30
on update c_o:
    cUpdated = true
    if c_o[x, y] != (30, 20):
        fail("c_o[x, y] != (30, 40)")

// Test updating a collection object
list{int32} d_o{}
var list{int32}& d = d_o
d_o := {1, 2, 3}
on update d_o:
    dUpdated = true
    if d_o[0, 1, 2] != (1, 2, 3):
        fail("d_o[0, 1, 2] != (1, 2, 3)")

list{int32} e_o{1, 2, 3}
var list{int32}& e = e_o
e[1] := 4
on update e_o:
    eUpdated = true
    if e_o[0, 1, 2] != (1, 4, 3):
        fail("e_o[0, 1, 2] != (1, 4, 3)")

if !aUpdated: fail("!aUpdated")
if !bUpdated: fail("!bUpdated")
if !cUpdated: fail("!cUpdated")
if !dUpdated: fail("!dUpdated")
if !eUpdated: fail("!eUpdated")

if result: "tc_update04: OK"
