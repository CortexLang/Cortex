require 'rake/clean'
require "#{ENV['CORTEX_BUILD']}/version"

TARGET = :cortex

LIB = ['rt', 'dl', 'm']

LFLAGS ||= []
CFLAGS ||= []

ARTEFACT = "lib#{TARGET}.so"
LFLAGS << "--shared"

CLOBBER.include("#{ENV['CORTEX_TARGET']}/include/cortex/")

task :prebuild do
	verbose(false)
	includePath = "#{ENV['CORTEX_TARGET']}/include/cortex/#{VERSION}"
	sh "mkdir -p #{includePath}"
    sh "cp include/* #{includePath}/"
end

task :collect do
	verbose(false)
	includePath = "#{ENV['HOME']}/.cortex/pack/include/cortex/#{VERSION}"
	sh "mkdir -p #{includePath}"
    sh "cp include/* #{includePath}/"

	buildPath = "#{ENV['HOME']}/.cortex/pack/lib/cortex/#{VERSION}/build"
	sh "mkdir -p #{buildPath}"
    sh "cp #{ENV['CORTEX_BUILD']}/* #{buildPath}/"    
end

require "#{ENV['CORTEX_BUILD']}/artefact"